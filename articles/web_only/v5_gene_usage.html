<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gene usage analysis • immunarch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><!-- docsearch --><script src="../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../../extra.css" rel="stylesheet">
<meta property="og:title" content="Gene usage analysis">
<meta property="og:description" content="immunarch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-128418614-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-128418614-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">immunarch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Start Here
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/v1_introduction.html">Installation &amp; troubleshooting</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">First steps</li>
    <li>
      <a href="../../articles/v2_data.html">Data loading</a>
    </li>
    <li>
      <a href="../../articles/web_only/load_mixcr.html">How-to: Loading MiXCR Data</a>
    </li>
    <li>
      <a href="../../articles/web_only/load_10x.html">How-to: Loading 10x Genomics Data</a>
    </li>
    <li>
      <a href="../../articles/web_only/v21_singlecell.html">How-to: Single-cell and paired chain data</a>
    </li>
    <li>
      <a href="../../articles/web_only/v3_basic_analysis.html">Basic statistics and clonality</a>
    </li>
    <li>
      <a href="../../articles/web_only/repFilter_v3.html">Data filtering</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Repertoire-level exploration and comparison</li>
    <li>
      <a href="../../articles/web_only/v4_overlap.html">Repertoire overlap and public clonotypes</a>
    </li>
    <li>
      <a href="../../articles/web_only/v5_gene_usage.html">Gene usage</a>
    </li>
    <li>
      <a href="../../articles/web_only/v6_diversity.html">Diversity estimation</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Clonotype-level exploration and comparison</li>
    <li>
      <a href="../../articles/web_only/v8_tracking.html">Track clonotypes across samples and time</a>
    </li>
    <li>
      <a href="../../articles/web_only/v11_db.html">Annotate clonotypes using immune receptor databases</a>
    </li>
    <li>
      <a href="../../articles/web_only/v9_kmers.html">Kmer and sequence motif analysis and visualisation</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Preparing to publication</li>
    <li>
      <a href="../../articles/web_only/v7_fixvis.html">Make your plots publication-ready with fixVis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://github.com/immunomind/covid19">COVID-19</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://immunomind.io">ImmunoMind</a>
</li>
<li>
  <a href="http://twitter.com/immunomind">
    <span class="fa fa-lg fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/immunomind/immunarch">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="v5_gene_usage_files/header-attrs-2.11/header-attrs.js"></script><script src="v5_gene_usage_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Gene usage analysis</h1>
                        <h4 class="author">
<b>ImmunoMind</b> – improving design of T-cell therapies using multi-omics and AI. Research and biopharma partnerships, more details: <a href="https://immunomind.io">immunomind.io</a>
</h4>
            
            <h4 class="date"><a href="mailto:support@immunomind.io" class="email">support@immunomind.io</a></h4>
      
      <small class="dont-index">Source: <a href="https://github.com/immunomind/immunarch/blob/master/vignettes/web_only/v5_gene_usage.Rmd"><code>vignettes/web_only/v5_gene_usage.Rmd</code></a></small>
      <div class="hidden name"><code>v5_gene_usage.Rmd</code></div>

    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Gene usage analysis}
%\VignettePackage{immunarch}
-->
<div id="gene-usage-computation" class="section level1">
<h1 class="hasAnchor">
<a href="#gene-usage-computation" class="anchor"></a>Gene usage computation</h1>
<p><code>immunarch</code> comes with a gene segments data table containing known gene segments for several species following the <a href="http://www.imgt.org/IMGTrepertoire/LocusGenes/">IMGT</a> nomenclature. In order to get the current statistics of genes, call the <code><a href="../../reference/gene_stats.html">gene_stats()</a></code> function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/gene_stats.html">gene_stats</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##     alias                 species ighd ighj ighv igij igkj igkv iglj iglv traj
## 1      bt               BosTaurus   21    4   25    0    1    6    5   26   46
## 2      cd      CamelusDromedarius    0    0    0    0    0    0    0    0    0
## 3     clf    CanisLupusFamiliaris    0    0    0    0    0    0    0    0    0
## 4      dr              DanioRerio    7    7    0    3    0    0    0    0    0
## 5      hs             HomoSapiens   30   13  248    0    5   64    7   69   57
## 6  macmul           MacacaMulatta   24    7   19    0    4   83    5    0    0
## 7     mmc    MusMusculusCastaneus    0    0    0    0    0    4    0    0    0
## 8     mmd   MusMusculusDomesticus    0    0    0    0    0    2    0    0    0
## 9  musmus             MusMusculus   32    8  225    0    8  109    3    5   42
## 10     oa OrnithorhynchusAnatinus    3   10    0    0    0    0    0    0    0
## 11     oc    OryctolagusCuniculus   10   11   39    0    8   26    2   20    0
## 12     om      OncorhynchusMykiss    9    7    6    0    0    0    0    0    0
## 13     rn        RattusNorvegicus   30    4  113    0    6  132    2    8    0
## 14   smth   MusMusculusMolossinus    0    0    0    0    0    1    0    0    0
## 15   smth     MusMusculusMusculus    0    0    0    0    0    1    0    0    0
## 16   smth              MusSpretus    0    0    0    0    0    2    0    2    0
## 17     ss               SusScrofa    5    5   15    0    8   19    4   14    0
##    trav trbd trbj trbv trdd trdj trdv trgj trgv
## 1     0    0    0    0    5    3    0    6   15
## 2     0    0    0    0    0    0    7    2    2
## 3     0    2    8   19    0    0    0    7    8
## 4     0    0    0    0    0    0    0    0    0
## 5    60    3   14   64    3    4    6    4   10
## 6     0    2   15   58    0    0    0    0    0
## 7     0    0    0    0    0    0    0    0    0
## 8     0    0    0    0    0    0    0    0    0
## 9   145    2   14   23    2    3    7    0   11
## 10    0    0    0    0    0    0    0    0    0
## 11    0    0    0    0    0    0    0    0    0
## 12    0    1    9    0    0    0    0    0    0
## 13    0    0    0    0    0    0    0    0    0
## 14    0    0    0    0    0    0    0    0    0
## 15    0    0    0    0    0    0    0    0    0
## 16    0    0    0    0    0    0    0    0    0
## 17    0    0    0    0    0    0    0    0    0</code></pre>
<p>To compute the distributions of genes, <code>immunarch</code> includes the <code>geneUsage</code> function. It receives a repertoire or a list of repertoires as input and genes and species for which you want to get the statistics. E.g., if you plan to use <code>TRBV</code> genes of <code>Homo Sapiens</code>, you need to use the <code>hs.trbv</code> string in the function, where <code>hs</code> comes from the <code>alias</code> column and <code>trbv</code> is the gene name. Of if you plan to use <code>IGHJ</code> genes of <code>Mus Musculus</code>, you need to use <code>musmus.ighj</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Next four function calls are equal. "hs" is from the "alias" column.</span>
<span class="va">imm_gu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/geneUsage.html">geneUsage</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span>, <span class="st">"hs.trbv"</span><span class="op">)</span>
<span class="co"># imm_gu = geneUsage(immdata$data, "HomoSapiens.trbv")</span>
<span class="co"># imm_gu = geneUsage(immdata$data, "hs.TRBV")</span>
<span class="co"># imm_gu = geneUsage(immdata$data, "HomoSapiens.TRBV")</span>

<span class="va">imm_gu</span></code></pre></div>
<pre><code>## # A tibble: 48 × 13
##    Names `A2-i129` `A2-i131` `A2-i133` `A2-i132` `A4-i191` `A4-i192`   MS1   MS2
##    &lt;chr&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1 TRBV…        24        28        NA        16        29         6    19     4
##  2 TRBV…        42        60         8        29        28        16    25    35
##  3 TRBV…       230       282       135       108       376       215   195   142
##  4 TRBV…        21        14        26        17        17        16    14    10
##  5 TRBV…       183       172       125       161        95       113    94   105
##  6 TRBV…         8        11         5        24         2         7     4    13
##  7 TRBV…       603       459       313       433       333       557   406   606
##  8 TRBV…        37        54         8        38        18        17     7    17
##  9 TRBV…        44        53        45        78        29        43    39    28
## 10 TRBV…        65        91        48        73        40        30    23    94
## # … with 38 more rows, and 4 more variables: MS3 &lt;int&gt;, MS4 &lt;int&gt;, MS5 &lt;int&gt;,
## #   MS6 &lt;int&gt;</code></pre>
<p>Gene distributions could be computed either using counts of individual clonotypes (<code>.quant = "count"</code>) or not using them (<code>.quant = NA</code>).</p>
<p>In order to compute allele-level or family-level distributions, change the <code>.type</code> parameter.</p>
<p>Parameter <code>.norm</code> controls whether <code>immunarch</code> will normalise the data to ensure the sum of all frequencies to be equal 1 or not.</p>
<p>You can visualise the histogram of gene usage in different ways:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compute the distribution of the first two samples</span>
<span class="va">imm_gu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/geneUsage.html">geneUsage</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span>, <span class="st">"hs.trbv"</span>, .norm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="fu"><a href="../../reference/vis.html">vis</a></span><span class="op">(</span><span class="va">imm_gu</span><span class="op">)</span></code></pre></div>
<p><img src="v5_gene_usage_files/figure-html/unnamed-chunk-2-1.png" width="1152" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">imm_gu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/geneUsage.html">geneUsage</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span>, <span class="st">"hs.trbv"</span>, .norm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="fu"><a href="../../reference/vis.html">vis</a></span><span class="op">(</span><span class="va">imm_gu</span>, .by <span class="op">=</span> <span class="st">"Status"</span>, .meta <span class="op">=</span> <span class="va">immdata</span><span class="op">$</span><span class="va">meta</span><span class="op">)</span></code></pre></div>
<p><img src="v5_gene_usage_files/figure-html/unnamed-chunk-3-1.png" width="1152" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/vis.html">vis</a></span><span class="op">(</span><span class="va">imm_gu</span>, .grid <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="v5_gene_usage_files/figure-html/unnamed-chunk-4-1.png" width="1440" style="display: block; margin: auto;"></p>
<p>Another practical approach to the visualisation of group distributions are box plots:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/vis.html">vis</a></span><span class="op">(</span><span class="va">imm_gu</span>, .by <span class="op">=</span> <span class="st">"Status"</span>, .meta <span class="op">=</span> <span class="va">immdata</span><span class="op">$</span><span class="va">meta</span>, .plot <span class="op">=</span> <span class="st">"box"</span><span class="op">)</span></code></pre></div>
<p><img src="v5_gene_usage_files/figure-html/unnamed-chunk-5-1.png" width="1152" style="display: block; margin: auto;"></p>
<div id="ambiguity-of-gene-segment-names" class="section level2">
<h2 class="hasAnchor">
<a href="#ambiguity-of-gene-segment-names" class="anchor"></a>Ambiguity of gene segment names</h2>
<p>Due to the ambiguity of gene alignments for some clonotypes, <code>geneUsage</code> has the following options to deal with ambiguous data:</p>
<ul>
<li><p><code>.ambig = "inc"</code> - includes all possible combinations of ambiguous gene alignments from the data. NOTE: ImmunoSEQ formats use non-standart gene segment names, so it is preferable to use this argument value with ImmunoSEQ formats. This argument is ON by default to ease the gene manipulation. Feel free to change it to <code>"exc"</code> in case of other data formats. It is ON by default, we recommend it to leave it that way.</p></li>
<li><p><code>.ambig = "exc"</code> - filters out all clonotypes with ambiguous gene alignments.</p></li>
<li><p><code>.ambig = "wei"</code> - introduces weighted approach (divides by n (<code>1/n</code>) the frequency for each entry of the corresponding gene if there are <code>n</code> genes for a clonotype).</p></li>
<li><p><code>.ambig = "maj"</code> - chooses only the first gene segment.</p></li>
</ul>
</div>
</div>
<div id="gene-usage-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#gene-usage-analysis" class="anchor"></a>Gene usage analysis</h1>
<p>To analyse the gene usage <code>immunarch</code> introduces the <code>geneUsageAnalysis</code> function. The <code>.method</code> parameter controls how the data is going to be preprocessed and analysed. <code>geneUsageAnalysis</code> includes following methods for preprocessing:</p>
<ul>
<li><p>“js” - Jensen-Shannon Divergence.</p></li>
<li><p>“cor” - correlation.</p></li>
<li><p>“cosine” - cosine similarity.</p></li>
<li><p>“pca” - principal component analysis.</p></li>
<li><p>“mds” - multi-dimensional scaling.</p></li>
<li><p>“tsne” - t-Distributed Stochastic Neighbor Embedding.</p></li>
</ul>
<p>And a few methods for the actual analysis:</p>
<ul>
<li><p>“hclust” - clusters the data using hierarchical clustering.</p></li>
<li><p>“kmeans” - clusters the data using K-means.</p></li>
<li><p>“dbscan” - clusters the data using DBSCAN.</p></li>
<li><p>“kruskall” - compute Kruskall for each gene separately on data splitted to groups (without preprocessing). Results could be used with Dunn test in order to detect significant differences between groups.</p></li>
</ul>
<p>You can call several methods in a single line of code, which is probably the most powerful feature of the package. For instance, <code>"js+hclust"</code> first computes Jensen-Shannon divergence and then applies hierarchical clustering on the resulting distance matrix, whereas <code>"anova"</code> computes ANOVA on each gene separately after repertoires have been grouped:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">imm_gu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/geneUsage.html">geneUsage</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span>, <span class="st">"hs.trbv"</span>, .norm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="va">imm_gu_js</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/geneUsageAnalysis.html">geneUsageAnalysis</a></span><span class="op">(</span><span class="va">imm_gu</span>, .method <span class="op">=</span> <span class="st">"js"</span>, .verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">imm_gu_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/geneUsageAnalysis.html">geneUsageAnalysis</a></span><span class="op">(</span><span class="va">imm_gu</span>, .method <span class="op">=</span> <span class="st">"cor"</span>, .verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/vis.html">vis</a></span><span class="op">(</span><span class="va">imm_gu_js</span>, .title <span class="op">=</span> <span class="st">"Gene usage JS-divergence"</span>, .leg.title <span class="op">=</span> <span class="st">"JS"</span>, .text.size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/vis.html">vis</a></span><span class="op">(</span><span class="va">imm_gu_cor</span>, .title <span class="op">=</span> <span class="st">"Gene usage correlation"</span>, .leg.title <span class="op">=</span> <span class="st">"Cor"</span>, .text.size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></code></pre></div>
<p><img src="v5_gene_usage_files/figure-html/unnamed-chunk-6-1.png" width="1152" style="display: block; margin: auto;"></p>
<p>Now let us visualise the output after both preprocessing and analysis:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">imm_gu_js</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">imm_gu_js</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="fu"><a href="../../reference/vis.html">vis</a></span><span class="op">(</span><span class="fu"><a href="../../reference/geneUsageAnalysis.html">geneUsageAnalysis</a></span><span class="op">(</span><span class="va">imm_gu</span>, <span class="st">"cosine+hclust"</span>, .verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="v5_gene_usage_files/figure-html/unnamed-chunk-7-1.png" width="960" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># vis(geneUsageAnalysis(imm_gu, "js+dbscan", .verbose = F))</span></code></pre></div>
<p>On top of that you can add clustering:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">imm_cl_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/geneUsageAnalysis.html">geneUsageAnalysis</a></span><span class="op">(</span><span class="va">imm_gu</span>, <span class="st">"js+pca+kmeans"</span>, .verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">imm_cl_mds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/geneUsageAnalysis.html">geneUsageAnalysis</a></span><span class="op">(</span><span class="va">imm_gu</span>, <span class="st">"js+mds+kmeans"</span>, .verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">imm_cl_tsne</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/geneUsageAnalysis.html">geneUsageAnalysis</a></span><span class="op">(</span><span class="va">imm_gu</span>, <span class="st">"js+tsne+kmeans"</span>, .perp <span class="op">=</span> <span class="fl">.01</span>, .verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<pre><code>## Perplexity should be lower than K!</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/vis.html">vis</a></span><span class="op">(</span><span class="va">imm_cl_pca</span>, .plot <span class="op">=</span> <span class="st">"clust"</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/vis.html">vis</a></span><span class="op">(</span><span class="va">imm_cl_mds</span>, .plot <span class="op">=</span> <span class="st">"clust"</span><span class="op">)</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/vis.html">vis</a></span><span class="op">(</span><span class="va">imm_cl_tsne</span>, .plot <span class="op">=</span> <span class="st">"clust"</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span></code></pre></div>
<p><img src="v5_gene_usage_files/figure-html/unnamed-chunk-8-1.png" width="1152" style="display: block; margin: auto;"></p>
<p>You can regulate the number of clusters as well:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">imm_cl_pca2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/geneUsageAnalysis.html">geneUsageAnalysis</a></span><span class="op">(</span><span class="va">imm_gu</span>, <span class="st">"js+pca+kmeans"</span>, .k <span class="op">=</span> <span class="fl">3</span>, .verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="fu"><a href="../../reference/vis.html">vis</a></span><span class="op">(</span><span class="va">imm_cl_pca2</span><span class="op">)</span></code></pre></div>
<p><img src="v5_gene_usage_files/figure-html/unnamed-chunk-9-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div id="spectratyping" class="section level1">
<h1 class="hasAnchor">
<a href="#spectratyping" class="anchor"></a>Spectratyping</h1>
<p>Spectratype is a useful way to represent distributions of genes per sequence length. Parameter <code>.quant</code> controls the quantity that used to compute proportions of genes - either by clonotype (<code>id</code>) or by number of clones per clonotype (<code>count</code>). Parameter <code>.col</code> controls which column to choose, e.g., “nt” for lengths of CDR3 nucleotide sequences only (without grouping by gene segments), “aa+v” for lengths of CDR3 amino acid sequences (grouped by V gene segments).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/vis.html">vis</a></span><span class="op">(</span><span class="fu"><a href="../../reference/spectratype.html">spectratype</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, .quant <span class="op">=</span> <span class="st">"id"</span>, .col <span class="op">=</span> <span class="st">"nt"</span><span class="op">)</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/vis.html">vis</a></span><span class="op">(</span><span class="fu"><a href="../../reference/spectratype.html">spectratype</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, .quant <span class="op">=</span> <span class="st">"count"</span>, .col <span class="op">=</span> <span class="st">"aa+v"</span><span class="op">)</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></code></pre></div>
<p><img src="v5_gene_usage_files/figure-html/spectr-1.png" width="1152" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.linkedin.com/in/vdnaz">Vadim I. Nazarov</a>, <a href="https://www.linkedin.com/in/vasily-tsvetkov-227218ab">Vasily O. Tsvetkov</a>, Eugene Rumynskiy, Aleksandr A. Popov, Ivan Balashov, <a href="https://immunomind.io">ImmunoMind</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '94207562f34b455c0796790d104e3549',
    indexName: 'immunarch',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
