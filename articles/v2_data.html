<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data loading • immunarch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Data loading">
<meta property="og:description" content="immunarch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-128418614-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-128418614-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">immunarch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Start Here
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/v1_introduction.html">Installation &amp; troubleshooting</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">First steps</li>
    <li>
      <a href="../articles/v2_data.html">Data loading</a>
    </li>
    <li>
      <a href="../articles/web_only/load_mixcr.html">How-to: Loading MiXCR Data</a>
    </li>
    <li>
      <a href="../articles/web_only/load_10x.html">How-to: Loading 10x Genomics Data</a>
    </li>
    <li>
      <a href="../articles/web_only/v21_singlecell.html">How-to: Single-cell and paired chain data</a>
    </li>
    <li>
      <a href="../articles/web_only/v3_basic_analysis.html">Basic statistics and clonality</a>
    </li>
    <li>
      <a href="../articles/web_only/repFilter_v3.html">Data filtering</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Repertoire-level exploration and comparison</li>
    <li>
      <a href="../articles/web_only/v4_overlap.html">Repertoire overlap and public clonotypes</a>
    </li>
    <li>
      <a href="../articles/web_only/v5_gene_usage.html">Gene usage</a>
    </li>
    <li>
      <a href="../articles/web_only/v6_diversity.html">Diversity estimation</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Clonotype-level exploration and comparison</li>
    <li>
      <a href="../articles/web_only/v8_tracking.html">Track clonotypes across samples and time</a>
    </li>
    <li>
      <a href="../articles/web_only/v11_db.html">Annotate clonotypes using immune receptor databases</a>
    </li>
    <li>
      <a href="../articles/web_only/v9_kmers.html">Kmer and sequence motif analysis and visualisation</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Preparing to publication</li>
    <li>
      <a href="../articles/web_only/v7_fixvis.html">Make your plots publication-ready with fixVis</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">BCR analysis</li>
    <li>
      <a href="../articles/web_only/BCRpipeline.html">BCR pipeline</a>
    </li>
    <li>
      <a href="../articles/web_only/clustering.html">Clustering</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://github.com/immunomind/covid19" class="external-link">COVID-19</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://immunomind.io" class="external-link">ImmunoMind</a>
</li>
<li>
  <a href="http://twitter.com/immunomind" class="external-link">
    <span class="fa fa-lg fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/immunomind/immunarch" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="v2_data_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Data loading</h1>
                        <h4 data-toc-skip class="author">
<b>ImmunoMind</b> – improving design of T-cell therapies using multi-omics and AI. Research and biopharma partnerships, more details: <a href="https://immunomind.io" class="external-link">immunomind.io</a>
</h4>
            
            <h4 data-toc-skip class="date"><a href="mailto:support@immunomind.io" class="email">support@immunomind.io</a></h4>
      
      <small class="dont-index">Source: <a href="https://github.com/immunomind/immunarch/blob/HEAD/vignettes/v2_data.Rmd" class="external-link"><code>vignettes/v2_data.Rmd</code></a></small>
      <div class="hidden name"><code>v2_data.Rmd</code></div>

    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Working with data in immunarch}
%\VignettePackage{immunarch}
-->
<div class="section level2">
<h2 id="input-output">Input / output<a class="anchor" aria-label="anchor" href="#input-output"></a>
</h2>
<p>The package provides several IO functions:</p>
<ul>
<li><p><code>repLoad</code> - loads the repertoires having compatible format.</p></li>
<li><p><code>repSave</code> - saves changes and writes the repertoire data to a file in a specific format (<code>immunarch</code>, VDJtools).</p></li>
</ul>
<p><code>repLoad</code> detects the input file format automatically. <code>immunarch</code> currently support the following immune repertoire data formats:</p>
<ul>
<li><p><code>"immunarch"</code> - current software tool, in case you forgot :)</p></li>
<li><p><code>"immunoseq"</code> - <a href="https://www.immunoseq.com" class="external-link uri">https://www.immunoseq.com</a></p></li>
<li><p><code>"mitcr"</code> - <a href="https://github.com/milaboratory/mitcr" class="external-link uri">https://github.com/milaboratory/mitcr</a></p></li>
<li><p><code>"mixcr"</code> - <a href="https://github.com/milaboratory/mixcr" class="external-link uri">https://github.com/milaboratory/mixcr</a></p></li>
<li><p><code>"migec"</code> - <a href="http://migec.readthedocs.io/en/latest/" class="external-link uri">http://migec.readthedocs.io/en/latest/</a></p></li>
<li><p><code>"migmap"</code> - <a href="https://github.com/mikessh/migmap" class="external-link uri">https://github.com/mikessh/migmap</a></p></li>
<li><p><code>"tcr"</code> - <a href="https://imminfo.github.io/tcr/" class="external-link uri">https://imminfo.github.io/tcr/</a></p></li>
<li><p><code>"vdjtools"</code> - <a href="https://vdjtools-doc.readthedocs.io/en/master/" class="external-link uri">https://vdjtools-doc.readthedocs.io/en/master/</a></p></li>
<li><p><code>"imgt"</code> - <a href="https://www.imgt.org/HighV-QUEST/" class="external-link uri">https://www.imgt.org/HighV-QUEST/</a></p></li>
<li><p><code>"airr"</code> - <a href="http://docs.airr-community.org/en/latest/datarep/overview.html" class="external-link uri">http://docs.airr-community.org/en/latest/datarep/overview.html</a></p></li>
<li><p><code>"10x"</code> - <a href="https://support.10xgenomics.com/single-cell-vdj/software/pipelines/latest/output/annotation" class="external-link uri">https://support.10xgenomics.com/single-cell-vdj/software/pipelines/latest/output/annotation</a></p></li>
<li><p><code>"archer"</code> - ArcherDX clonotype tables.</p></li>
<li><p><code>"imseq"</code> - <a href="http://www.imtools.org/" class="external-link uri">http://www.imtools.org/</a></p></li>
<li><p><code>"rtcr"</code> - <a href="https://github.com/uubram/RTCR" class="external-link uri">https://github.com/uubram/RTCR</a></p></li>
<li><p><code>"vidjil"</code> - <a href="http://www.vidjil.org/" class="external-link uri">http://www.vidjil.org/</a></p></li>
</ul>
<p>Please contact us if there are more file formats you want supported.</p>
<p>For parsing IgBLAST results process the data with MigMap first.</p>
<p>You can load the data from a single file, a list of repertoire file paths, or from a folder with repertoire files.</p>
<p><strong>Working with your files</strong></p>
<p>If you have your files, you should just specify a path to your file or to a folder with files. Then load data using <code>repLoad</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#path argument is a path to the folder with your file or files including the metadata file.</span>
<span class="va">immdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/repLoad.html">repLoad</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></code></pre></div>
<p><strong>Working with sample files</strong></p>
<p>You could find a folder with example files <a href="https://github.com/immunomind/immunarch/releases/tag/0.6.7" class="external-link">here</a> (download and extract test_data.zip or test_data.tar.gz) and use it to test data loading without your own files.</p>
<p>If you are not familiar with the file paths, you can download our mock data to your working directory. You can obtain working directory with <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code> command</p>
<p>You could also download all files to the <code>'example'</code> folder in your working directory and load all of them by passing folder name to repLoad function in quotation marks:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">immdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/repLoad.html">repLoad</a></span><span class="op">(</span><span class="st">'example'</span><span class="op">)</span></code></pre></div>
<p>The example data is already downloaded with <code>immunarch</code> package. You can load all sample files using the following command:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#path to the folder with example data</span>
<span class="va">file_path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"immunarch"</span><span class="op">)</span>, <span class="st">"/extdata/io/"</span><span class="op">)</span>
<span class="va">immdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/repLoad.html">repLoad</a></span><span class="op">(</span><span class="va">file_path</span><span class="op">)</span></code></pre></div>
<p>In other cases you may want to provide a metadata file and locate it in the folder. It is necessary to name it “metadata.txt”.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># For instance you have a following structure in your folder:</span>
<span class="co"># &gt;_ ls</span>
<span class="co"># immunoseq1.txt</span>
<span class="co"># immunoseq2.txt</span>
<span class="co"># immunoseq3.txt</span>
<span class="co"># metadata.txt</span></code></pre></div>
<p>With the metadata <code>repLoad</code> will create a list in the environment with 2 elements, namely <code>data</code> and <code>meta</code>. All the data will be accessible simply from <code>immdata$data</code>.</p>
<p>Otherwise <code>repLoad</code> will create a dummy metadata file with only sample names.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># To load the whole folder with every file in it type:</span>
<span class="va">file_path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"immunarch"</span><span class="op">)</span>, <span class="st">"/extdata/io/"</span><span class="op">)</span>
<span class="va">immdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/repLoad.html">repLoad</a></span><span class="op">(</span><span class="va">file_path</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">)</span><span class="op">)</span>

<span class="co"># In order to do that your folder must contain metadata file named</span>
<span class="co"># "metadata.txt".</span>

<span class="co"># In R, when you load your data:</span>
<span class="co"># &gt; immdata &lt;- repLoad("path/to/your/folder/")</span>
<span class="co"># &gt; names(immdata)</span>
<span class="co"># [1] "data" "meta"</span>

<span class="co"># Suppose you do not have "metadata.txt":</span>
<span class="co"># &gt; immdata &lt;- repLoad("path/to/your/folder/")</span>
<span class="co"># &gt; names(immdata)</span>
<span class="co"># [1] "data" "meta"</span></code></pre></div>
<p>Dummy metadata data frame looks like this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"immunoseq1"</span>, <span class="st">"immunoseq2"</span>, <span class="st">"immunoseq3"</span><span class="op">)</span>, stringsAsFactors <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 3 × 1</span></span>
<span class="co">##   Sample    </span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span>
<span class="co">## <span style="color: #BCBCBC;">1</span> immunoseq1</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> immunoseq2</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> immunoseq3</span></code></pre>
<p>The metadata file “metadata.txt” has to be a table with first column named “Sample” and any number of additional columns with any names. The first column should contain the base names of files without extensions in your folder.</p>
<table class="table">
<thead><tr class="header">
<th align="center"><strong>Sample</strong></th>
<th align="center"><strong>Sex</strong></th>
<th align="center"><strong>Age</strong></th>
<th align="center"><strong>Status</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">immunoseq_1</td>
<td align="center">M</td>
<td align="center">1</td>
<td align="center">C</td>
</tr>
<tr class="even">
<td align="center">immunoseq_2</td>
<td align="center">M</td>
<td align="center">2</td>
<td align="center">C</td>
</tr>
<tr class="odd">
<td align="center">immunoseq_3</td>
<td align="center">F</td>
<td align="center">3</td>
<td align="center">A</td>
</tr>
</tbody>
</table>
<p>In order to import data from the external databases you have to connect to this database and then load the data. Make sure that the table format in your database matches the <code>immunarch</code>’s format.</p>
<p>To illustrate the use of external database, here is an example demonstrating data loading to the local MonetDB database:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Your list of repertoires in immunarch's format</span>
<span class="va">DATA</span>
<span class="co"># Metadata data frame</span>
<span class="va">META</span>

<span class="co"># Create a temporary directory</span>
<span class="va">dbdir</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Create a DBI connection to MonetDB in the temporary directory.</span>
<span class="va">con</span> <span class="op">=</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">MonetDBLite</span><span class="fu">::</span><span class="fu">MonetDBLite</span><span class="op">(</span><span class="op">)</span>, embedded <span class="op">=</span> <span class="va">dbdir</span><span class="op">)</span>

<span class="co"># Write each repertoire to MonetDB. Each table has corresponding name from the DATA</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">DATA</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">DATA</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">DATA</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Create a source in the temporary directory with MonetDB</span>
<span class="va">ms</span> <span class="op">=</span> <span class="fu">MonetDBLite</span><span class="fu">::</span><span class="fu">src_monetdblite</span><span class="op">(</span>dbdir <span class="op">=</span> <span class="va">dbdir</span><span class="op">)</span>
<span class="va">res_db</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Load the data from MonetDB to dplyr tables</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">DATA</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">res_db</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">DATA</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">ms</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">DATA</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Your data is ready to use</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">res_db</span>, meta <span class="op">=</span> <span class="va">META</span><span class="op">)</span></code></pre></div>
<p><code>immunarch</code> is compatible with the following sources:</p>
<ul>
<li><p>R data frames (for most applications)</p></li>
<li><p>R data tables (for faster calculations, although they require a lot of RAM)</p></li>
<li><p>MonetDB-like databases that support both DBI and dplyr (an optimal choice, although you have to be familiar with dplyr)</p></li>
<li><p>Apache Spark (if you have experience with it)</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="basic-data-manipulations-with-dplyr-and-immunarch">Basic data manipulations with dplyr and immunarch<a class="anchor" aria-label="anchor" href="#basic-data-manipulations-with-dplyr-and-immunarch"></a>
</h2>
<p>You can find the introduction to <code>dplyr</code> here: <a href="https://CRAN.R-project.org/package=dplyr/vignettes/dplyr.html" class="external-link uri">https://CRAN.R-project.org/package=dplyr/vignettes/dplyr.html</a></p>
<div class="section level3">
<h3 id="get-the-most-abundant-clonotypes">Get the most abundant clonotypes<a class="anchor" aria-label="anchor" href="#get-the-most-abundant-clonotypes"></a>
</h3>
<p>The function returns the most abundant clonotypes for the given repertoire:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/top.html">top</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 10 × 15</span></span>
<span class="co">##    Clones Proportion CDR3.nt    CDR3.aa V.name D.name J.name V.end D.start D.end</span>
<span class="co">##     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>    173    0.020<span style="text-decoration: underline;">4</span>  TGCGCCAGC… CASSQE… TRBV4… TRBD1  TRBJ2…    16      18    26</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>    163    0.019<span style="text-decoration: underline;">2</span>  TGCGCCAGC… CASSYR… TRBV4… TRBD1  TRBJ2…    11      13    18</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     66    0.007<span style="text-decoration: underline;">76</span> TGTGCCACC… CATSTN… TRBV15 TRBD1  TRBJ2…    11      16    22</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     54    0.006<span style="text-decoration: underline;">35</span> TGTGCCACC… CATSIG… TRBV15 TRBD2  TRBJ2…    11      19    25</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     48    0.005<span style="text-decoration: underline;">65</span> TGTGCCAGC… CASSPW… TRBV27 TRBD1  TRBJ1…    11      16    23</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     48    0.005<span style="text-decoration: underline;">65</span> TGCGCCAGC… CASQGD… TRBV4… TRBD1  TRBJ1…     8      13    19</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     40    0.004<span style="text-decoration: underline;">71</span> TGCGCCAGC… CASSQD… TRBV4… TRBD1  TRBJ2…    16      21    26</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     31    0.003<span style="text-decoration: underline;">65</span> TGTGCCAGC… CASSEE… TRBV2  TRBD1  TRBJ1…    15      17    20</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     30    0.003<span style="text-decoration: underline;">53</span> TGCGCCAGC… CASSQP… TRBV4… TRBD1  TRBJ2…    14      23    28</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>     28    0.003<span style="text-decoration: underline;">29</span> TGTGCCAGC… CASSWV… TRBV6… TRBD1  TRBJ2…    12      20    25</span>
<span class="co">## <span style="color: #949494;"># … with 5 more variables: J.start &lt;int&gt;, VJ.ins &lt;dbl&gt;, VD.ins &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   DJ.ins &lt;dbl&gt;, Sequence &lt;lgl&gt;</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="filter-functional-non-functional-in-frame-out-of-frame-clonotypes">Filter functional / non-functional / in-frame / out-of-frame clonotypes<a class="anchor" aria-label="anchor" href="#filter-functional-non-functional-in-frame-out-of-frame-clonotypes"></a>
</h3>
<p>Conveniently, functions are vectorised over the list of data frames; and <code>coding(immdata$data)</code> in the example below returns a list of data frames with coding sequences:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/coding.html">coding</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>The next one operates in a similar fashion:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/coding.html">noncoding</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>Now, the computation of the number of filtered sequences is rather straightforward:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="../reference/coding.html">inframes</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>And for the out-of-frame clonotypes:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="../reference/coding.html">outofframes</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-subset-of-clonotypes-with-a-specific-v-gene">Get subset of clonotypes with a specific V gene<a class="anchor" aria-label="anchor" href="#get-subset-of-clonotypes-with-a-specific-v-gene"></a>
</h3>
<p>It is simple to subset data frame according to labels in the specified index. In this example the resulting data frame contains only records with ‘TRBV10-1’ V gene:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">V.name</span> <span class="op">==</span> <span class="st">'TRBV10-1'</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 24 × 15</span></span>
<span class="co">##    Clones Proportion CDR3.nt    CDR3.aa V.name D.name J.name V.end D.start D.end</span>
<span class="co">##     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>      2   0.000<span style="text-decoration: underline;">235</span> TGCGCCAGC… CASSES… TRBV1… TRBD2  TRBJ2…    16      20    25</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>      2   0.000<span style="text-decoration: underline;">235</span> TGCGCCAGC… CASSDG… TRBV1… TRBD1  TRBJ2…    13      15    22</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>      1   0.000<span style="text-decoration: underline;">118</span> TGCGCCAGC… CASSGD… TRBV1… TRBD2  TRBJ2…     8      10    15</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>      1   0.000<span style="text-decoration: underline;">118</span> TGCGCCACC… CATLRS… TRBV1… TRBD1  TRBJ2…     6       7     9</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>      1   0.000<span style="text-decoration: underline;">118</span> TGCGCCAGC… CASSES… TRBV1… TRBD2  TRBJ2…    16      20    22</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>      1   0.000<span style="text-decoration: underline;">118</span> TGCGCCAGC… CASSES… TRBV1… TRBD2  TRBJ2…    16      17    21</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>      1   0.000<span style="text-decoration: underline;">118</span> TGCGCCAGC… CASRAS… TRBV1… TRBD2  TRBJ2…    10      13    21</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>      1   0.000<span style="text-decoration: underline;">118</span> TGCGCCAGC… CASRRD… TRBV1… TRBD1  TRBJ2…     8      13    19</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>      1   0.000<span style="text-decoration: underline;">118</span> TGCGCCAGC… CASSEV… TRBV1… TRBD1  TRBJ2…    14      19    24</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>      1   0.000<span style="text-decoration: underline;">118</span> TGCGCCAGC… CASSEG… TRBV1… TRBD2  TRBJ2…    13      19    27</span>
<span class="co">## <span style="color: #949494;"># … with 14 more rows, and 5 more variables: J.start &lt;int&gt;, VJ.ins &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   VD.ins &lt;dbl&gt;, DJ.ins &lt;dbl&gt;, Sequence &lt;lgl&gt;</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="downsampling">Downsampling<a class="anchor" aria-label="anchor" href="#downsampling"></a>
</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ds</span> <span class="op">=</span> <span class="fu"><a href="../reference/repSample.html">repSample</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span>, <span class="st">"downsample"</span>, <span class="fl">100</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ds</span>, <span class="va">nrow</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## A2-i129 A2-i131 A2-i133 A2-i132 A4-i191 A4-i192     MS1     MS2     MS3     MS4 </span>
<span class="co">##      95      99      95     100      91      95      83     100      93     100 </span>
<span class="co">##     MS5     MS6 </span>
<span class="co">##      82     100</span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ds</span> <span class="op">=</span> <span class="fu"><a href="../reference/repSample.html">repSample</a></span><span class="op">(</span><span class="va">immdata</span><span class="op">$</span><span class="va">data</span>, <span class="st">"sample"</span>, .n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ds</span>, <span class="va">nrow</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## A2-i129 A2-i131 A2-i133 A2-i132 A4-i191 A4-i192     MS1     MS2     MS3     MS4 </span>
<span class="co">##      10      10      10      10      10      10      10      10      10      10 </span>
<span class="co">##     MS5     MS6 </span>
<span class="co">##      10      10</span></code></pre>
</div>
<div class="section level2">
<h2 id="immunarch-data-format">Immunarch data format<a class="anchor" aria-label="anchor" href="#immunarch-data-format"></a>
</h2>
<p><code>immunarch</code> comes with its own data format, including tab-delimited columns that can be specified as follows:</p>
<ul>
<li><p>“Clones” - count or number of barcodes (events, UMIs) or reads;</p></li>
<li><p>“Proportion” - proportion of barcodes (events, UMIs) or reads;</p></li>
<li><p>“CDR3.nt” - CDR3 nucleotide sequence;</p></li>
<li><p>“CDR3.aa” - CDR3 amino acid sequence;</p></li>
<li><p>“V.name” - names of aligned Variable gene segments;</p></li>
<li><p>“D.name” - names of aligned Diversity gene segments or NA;</p></li>
<li><p>“J.name” - names of aligned Joining gene segments;</p></li>
<li><p>“V.end” - last positions of aligned V gene segments (1-based);</p></li>
<li><p>“D.start” - positions of D’5 end of aligned D gene segments (1-based);</p></li>
<li><p>“D.end” - positions of D’3 end of aligned D gene segments (1-based);</p></li>
<li><p>“J.start” - first positions of aligned J gene segments (1-based);</p></li>
<li><p>“VJ.ins” - number of inserted nucleotides (N-nucleotides) at V-J junction (-1 for receptors with VDJ recombination);</p></li>
<li><p>“VD.ins” - number of inserted nucleotides (N-nucleotides) at V-D junction (-1 for receptors with VJ recombination);</p></li>
<li><p>“DJ.ins” - number of inserted nucleotides (N-nucleotides) at D-J junction (-1 for receptors with VJ recombination);</p></li>
<li><p>“Sequence” - full nucleotide sequence.</p></li>
</ul>
<!---
## Additional functions to help with dplyr

- `todf` - convert the input to R data frame.

- `todt` - convert the input to R data table.

- `db_add` - add a new column to the existing database.

- `db_rem` - remove a specific column from the existing database.

- `db_write` - write / rewrite a database table.

With these functions you can write the subset of your repertoires to new tables with `db_write`, after you have filtered out the noncoding sequences, for instance.

-->
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://www.linkedin.com/in/vdnaz" class="external-link">Vadim I. Nazarov</a>, <a href="https://www.linkedin.com/in/vasily-tsvetkov-227218ab" class="external-link">Vasily O. Tsvetkov</a>, <a href="https://www.linkedin.com/in/erumynskiy/" class="external-link">Eugene Rumynskiy</a>, <a href="https://www.linkedin.com/in/aleksandr-popov-634878105/" class="external-link">Aleksandr A. Popov</a>, <a href="https://www.linkedin.com/in/ivan-balashov/" class="external-link">Ivan Balashov</a>, <a href="https://www.linkedin.com/in/maria-volobueva-b0856a223/" class="external-link">Maria Samokhina</a>, <a href="https://immunomind.io" class="external-link">ImmunoMind</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '94207562f34b455c0796790d104e3549',
    indexName: 'immunarch',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
